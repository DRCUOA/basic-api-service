@startuml Class Diagram - Component Relationships

skinparam classAttributeIconSize 0

package "api/routes" {
  class routes {
    + routes({ taskController }): Router
    + get("/tasks"): listTasks
    + post("/tasks"): createTask
    + patch("/tasks/:id"): updateTasks
    + delete("/tasks/:id"): deleteTasks
  }
}

package "api/controllers" {
  class createTaskController {
    + createTaskController(taskService, logger): TaskController
  }
  
  class TaskController {
    + listTasks(req, res): Promise<void>
    + createTask(req, res): Promise<void>
    + updateTasks(req, res): Promise<void>
       + deleteTasks(req, res): Promise<void>
  }
}

package "domain" {
  class createTaskService {
    + createTaskService(tasksDao, logger): TaskService
  }
  
  class TaskService {
    + listTasks(): Promise<Task[]>
    + createTask(data): Promise<Task>
    + updateTasks(id, data): Promise<Task>
    + deleteTasks(id): Promise<void>
  }
}

package "data/models" {
  class tasksDao {
    + retrieveAllTasks(): Promise<Task[]>
    + retrieveTaskById(id): Promise<Task|null>
    + createTask(taskData): Promise<Task>
    + updateTask(id, updates): Promise<Task|null>
    + deleteTask(id): Promise<boolean>
  }
  
  class Task {
    + id: INTEGER
    + title: STRING
    + description: TEXT
    + completed: BOOLEAN
    + createdAt: DATE
    + updatedAt: DATE
    + findByPk(id): Promise<Task>
    + create(data): Promise<Task>
    + findAll(): Promise<Task[]>
    + update(updates): Promise<void>
    + destroy(): Promise<void>
    + toJSON(): Object
  }
}

package "utils" {
  class logger {
    + info(message, meta): void
    + error(message, meta): void
  }
}

package "Root" {
  class index {
    + app: Express
    + PORT: number
    + initializeApp(): Promise<void>
    + listen(): void
  }
}

package "data" {
  class database {
    + getSequelize(): Sequelize
    + testConnection(): Promise<boolean>
    + verifySchema(): Promise<void>
    - sequelize.sync(): Error (poisoned)
  }
  
  class databaseConfig {
    + development: Config
    + test: Config
  }
}

index --> routes : creates router
index --> database : connects to
index --> createTaskController : creates controller
index --> createTaskService : creates service
routes --> TaskController : routes to
createTaskController --> TaskController : creates
createTaskController --> TaskService : depends on
createTaskController --> logger : depends on
TaskController --> TaskService : calls
TaskController --> logger : uses
createTaskService --> TaskService : creates
createTaskService --> tasksDao : depends on
createTaskService --> logger : depends on
TaskService --> tasksDao : calls
TaskService --> logger : uses
tasksDao --> Task : uses Sequelize model
tasksDao --> logger : uses
database --> Task : provides Sequelize instance
databaseConfig ..> database : CLI config only

note top of routes
  Factory function
  HTTP Route definitions
  Maps URLs to controller functions
  All routes active
end note

note top of TaskController
  Factory function pattern
  Request/Response handling
  HTTP status codes
  Error handling
  Dependency injection
end note

note top of TaskService
  Factory function pattern
  Business logic layer
  Domain rules
  Orchestration
  Dependency injection
end note

note top of tasksDao
  Data Access Object
  Abstracts data persistence
  Uses Sequelize ORM
  All methods implemented
end note

note top of Task
  Sequelize model
  Maps to PostgreSQL tasks table
  Fields: id, title, description, completed, timestamps
  Validation on title field
end note

note top of database
  Sequelize runtime configuration
  Connection pooling enabled
  sync() method poisoned
  Migration-only schema control
  verifySchema() checks table exists
  Test environment guardrails
end note

@enduml
